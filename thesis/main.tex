\documentclass[a4paper,twoside,11pt]{book}
\usepackage[utf8]{inputenc}
\usepackage[english,brazil]{babel}
\usepackage{emptypage}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage[a4paper,top=3cm,bottom=3cm,left=3cm,right=3cm]{geometry}
\usepackage[colorlinks=true,citecolor=black,linkcolor=black,urlcolor=black,filecolor=black]{hyperref}
\usepackage{lastpage}
\usepackage{lipsum}
\usepackage{natbib}
\usepackage{amsmath,amssymb,amsfonts,amsthm}
\usepackage[chapter]{algorithm}
\usepackage{algpseudocode}
\usepackage{tikz}
\usepackage[nottoc]{tocbibind}
\usepackage{setspace}
\usepackage{xcolor}
\usepackage{booktabs}
\usepackage{thmtools}

\def\blankpage{%
  \clearpage%
  \thispagestyle{empty}%
  \null%
  \clearpage}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

\DeclareMathOperator*{\scope}{scope}
\DeclareMathOperator*{\ch}{ch}

\DeclareMathOperator*{\MAP}{MAP}
\DeclareMathOperator*{\MAX}{MAX}

\DeclareMathOperator*{\map}{map}
\DeclareMathOperator*{\amap}{amap}
\DeclareMathOperator*{\bestK}{bestK}
\DeclareMathOperator*{\kbt}{kbt}

\algnewcommand{\LineComment}[1]{\State \(\triangleright\) #1}
\algnewcommand{\Input}[1]{\State \textbf{Input:} #1}
\algnewcommand{\Output}[1]{\State \textbf{Output:} #1}

\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}{Lemma}[chapter]
\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{example}{Example}[chapter]

\pagestyle{fancy}
\fancyhf{}
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}}
\renewcommand{\sectionmark}[1]{\markright{\MakeUppercase{#1}}{}}
\renewcommand{\headrulewidth}{0pt}

\setlength{\emergencystretch}{5pt}

\newcommand{\TODO}[1]{\textbf{\color{red}{TODO: #1}}}

\setlength{\headheight}{14pt}

\bibpunct{(}{)}{;}{a}{,}{,}

\frenchspacing
\linespread{1.4}

\title{Finding Maxima of Gaussian Sum-Product Networks}
\author{Tiago Madeira}

\begin{document}
\makeatletter
\selectlanguage{english}

\frontmatter
\fancyhead[RO]{{\footnotesize\rightmark}\hspace{2em}\thepage}
\setcounter{tocdepth}{2}
\fancyhead[LE]{\thepage\hspace{2em}\footnotesize{\leftmark}}
\fancyhead[RE,LO]{}
\fancyhead[RO]{{\footnotesize\rightmark}\hspace{2em}\thepage}

\thispagestyle{empty}
\input{cover}

\thispagestyle{empty}
\selectlanguage{brazil}
\input{disclaimer}
\selectlanguage{english}

\pagenumbering{roman}

\input{acknowledgements}

\input{abstract}

\selectlanguage{brazil}
\input{resumo}
\selectlanguage{english}

\setcounter{secnumdepth}{0}
\input{lists}
\setcounter{secnumdepth}{2}

\tableofcontents

\mainmatter
\fancyhead[RE,LO]{\thesection}

\input{introduction}

\input{gmm}

\input{spn}

\input{algorithm}

\input{experiments}

\input{final}

\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{\appendixname\ \thechapter}} {\MakeUppercase{#1}} }
\fancyhead[RE,LO]{}
\appendix

\backmatter

\bibliographystyle{plainnat-ime}
\bibliography{references}
\end{document}
